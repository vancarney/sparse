// Generated by CoffeeScript 1.6.2
(function(){var e="prototype",t="className",n=null,r="objectId",i="__super__",s="success",o="Object",u="constructor",a="hasOwnProperty",f="updatedAt",l="createdAt",c="attributes",h="_toPointer",p="getConstructorName",d="destroy",v="objectClass",m="changedAttributes",g="extend",y="API_URI",b="__processed",w="__action",E="toJSON",S="__type",x="UNDEFINED_CLASSNAME",T="undefined",N="_finishFetch",C="_memberIsNew",k="stringify",L="Relation",A="GeoPoint",O=!1,M="operate",_="call",D="DEFAULT_FETCH_LIMIT_OVERRIDE",P="_encode",H=!0,B="isNew",j="isObject",F="error",I="SESSION_TOKEN",q="login",R="MAX_BATCH_SIZE",U="Collection",z="/classes/",W="__params",X="application/json",V="function",$="length",J="CRUD_METHODS",K="models",Q="__isDirty",G="_getSubclass",Y="Pointer",Z="_decode",et="replace",tt="__to_remove",nt="isArray",rt="urlMap",it="/users",st="__method",ot="create",ut="_parseDate",at="Inflection",ft="_mergeMagicFields",lt="__parse_classname",ct="File",ht="count",pt="_classMap",dt="apiOPTS",vt="getParams",mt="sessionToken",gt="Function",yt="dirty",bt="$1es",wt="attr",Et="validateRoute",St="each",xt="clone",Tt="limit",Nt="$exists",Ct="order",kt="complete",Lt="_prepareModel",At,Ot,Mt,_t,Dt,Pt,Ht={}[a],Bt=function(t,n){function s(){this[u]=t}for(var r in n)Ht[_](n,r)&&(t[r]=n[r]);return s[e]=n[e],t[e]=new s,t[i]=n[e],t};Ot=exports||window,typeof exports!==T&&(_t=require("underscore")._,At=require("backbone")),Ot.sparse||(Mt=Ot.sparse={VERSION:"0.3.1-alpha",APP_ID:void 0,REST_KEY:void 0,SESSION_TOKEN:void 0,API_VERSION:"1",MAX_BATCH_SIZE:50,DEFAULT_FETCH_LIMIT_OVERRIDE:2e5,UNDEFINED_CLASSNAME:"__UNDEFINED_CLASSNAME__",API_URI:"https://api.parse.com/1",CRUD_METHODS:{create:"POST",read:"GET",update:"PUT",destroy:"DELETE"}},Mt.initialize=function(e,t){return Mt.APP_ID=e,Mt.REST_KEY=t}),Mt[dt]=function(){return{contentType:X,processData:O,dataType:"json",data:n,headers:{"Content-Type":X,"X-Parse-Application-Id":Mt.APP_ID,"X-Parse-REST-API-Key":Mt.REST_KEY,"X-Parse-Session-Token":Mt[I]}}},Mt.regEscape=function(e){return e[et](/([\^\/\.\-\+\*\[\]\{\}\|\(\)\?\$]+)/g,"\\$1")},Mt[Et]=function(e){if(!e.match(new RegExp("^("+Mt.regEscape(Mt[y])+"/)?(batch|classes|events|files|functions|login|push|requestPasswordReset|users|jobs)+")))throw"Bad route: "+e;return H},Mt[ut]=function(e){var t;return(t=e.match(/^([0-9]{1,4})\-([0-9]{1,2})\-([0-9]{1,2})T+([0-9]{1,2}):+([0-9]{1,2}):?([0-9]{1,2})?(.([0-9]+))?Z+$/))===n?n:new Date(Date.UTC(t[1]||0,(t[2]||1)-1,t[3]||0,t[4]||0,t[5]||0,t[6]||0,t[8]||0))},Mt[p]=function(e){var t;return e[u].name||((t=e[u].toString().match(/function+\s{1,}([A-Z]{1}[a-zA-Z]*)/))!=n?t[1]:Mt[x])},Mt[P]=function(e,t,n){var r;if(e instanceof Mt.Model&&n)throw"sparse.Models not allowed here";if(e[a](h&&typeof e[h]===gt))return e[h]();if(e[a](yt&&typeof e[yt]===gt&&!e[yt]()))return Mt[P](e._toFullJSON(t=t.concat(e)),t,n);if(e instanceof Mt[o]&&e[B]())throw"Tried to save Model with a Pointer to an new or unsaved Object.";if(_t.isDate(e))return{__type:Date,iso:e[E]()};if(_t[nt](e))return _t.map(e,function(e){return Mt[P](e,t,n)});if(_t.isRegExp(e))return e.source;if(Mt[L]&&e instanceof Mt[L]||Mt.Op&&e instanceof Mt.Op||Mt[A]&&e instanceof Mt[A])return e[E]();if(Mt[ct]&&e instanceof Mt[ct]){if(!e.url())throw"Tried to save an object containing an unsaved file.";return{__type:ct,name:e.name(),url:e.url()}}return _t[j](e)?(r={},_t[St](e,function(e,i){return r[i]=Mt[P](e,t,n)}),r):e},Mt[Z]=function(e,i){var s,u,a,f,l;return _t[j](i)?_t[nt](i)?(_t[St](i,function(e,t){return i[t]=Mt[Z](t,e)}),i):i instanceof Mt[o]||Mt[ct]&&i instanceof Mt[ct]||Mt.OP&&i instanceof Mt.Op?i:i.__op?Mt.OP[Z](i):i[S]&&i[S]===Y?(f=Mt[o]._create(i[t]),f[N]({objectId:i[r]},O),f):i[S]&&i[S]===o?(s=i[t],delete i[S],delete i[t],a=Mt[o]._create(s),a[N](i,H),a):i[S]==="Date"?Mt[ut](i.iso):Mt[A]&&i[S]===A?new Mt[A]({latitude:i.latitude,longitude:i.longitude}):Mt[L]&&i[S]===L?((l=new Mt[L](n,e)).targetClassName=i[t],l):Mt[ct]&&i[S]===ct?((u=new sarse[ct](i.name)).url=i.url,u):(_t[St](i,function(e,t){return i[t]=Mt[Z](t,e)}),i):i},Mt[at]=new function(){return{__uncountable_words:["equipment","information","rice","money","species","series","fish","sheep","moose","deer","news"],__plural_rules:[[/(m)an$/gi,"$1en"],[/(pe)rson$/gi,"$1ople"],[/(child)$/gi,"$1ren"],[/^(ox)$/gi,"$1en"],[/(ax|test)is$/gi,bt],[/(octop|vir)us$/gi,"$1i"],[/(alias|status)$/gi,bt],[/(bu)s$/gi,"$1ses"],[/(buffal|tomat|potat)o$/gi,"$1oes"],[/([ti])um$/gi,"$1a"],[/sis$/gi,"ses"],[/(?:([^f])fe|([lr])f)$/gi,"$1$2ves"],[/(hive)$/gi,"$1s"],[/([^aeiouy]|qu)y$/gi,"$1ies"],[/(x|ch|ss|sh|lens)$/gi,bt],[/(matr|vert|ind)ix|ex$/gi,"$1ices"],[/([m|l])ouse$/gi,"$1ice"],[/(quiz)$/gi,"$1zes"],[/s$/gi,"s"],[/$/gi,"s"]],apply_rules:function(e,t,r){var i,s=this;return r.indexOf(e.toLowerCase())===-1&&(i=_t.find(t,function(t){return e.match(t[0])}))!=n?e[et](i[0],i[1]):e},pluralize:function(e){return this.apply_rules(e,this.__plural_rules,this.__uncountable_words)}}},Mt[o]=function(s){function d(e,r){var s;d[i][u][_](this,e,r),((s=this[t])!=n?s:this[t]=Mt[p](this))===Mt[x]?console.warn("sparse.Object requires className to be defined"):this[t]=Mt[at].pluralize(this[t])}return Bt(d,s),d[e].idAttribute=r,d[e].url=function(){return""+Mt[y]+z+this[t]+(this[B]()?"":"/"+this.get(r))},d[e].sync=function(e,t,r){var s,u,f,l=this;return r==n&&(r={}),u=Mt[dt](),s=function(e){return _t[j](e&&e[a](h&&typeof e[h]===V))&&(e=e[h]()),e},e.match(/^(create|read)+^/)&&_t[St](t[c],function(e,t){console.log("attr "+t+" is sparse.Object: "+(e instanceof Mt[o])),_t[j](e)&&(e=s(e));if(_t[nt](e))return _t.map(e,function(e){return _t[j]?s(e):e})}),u.data=JSON[k](this[E]()),Mt[Et]((f=r.url)!=n?f:r.url=_t.result(this,"url")||"/"),d[i].sync[_](this,e,t,_t[g](r,u))},d[e].set=function(e,t){var n;return e=Mt[P](e),n=d[i].set[_](this,e,t),this[m]()&&(this[Q]=H),n},d[e][E]=function(e){var t;return t=d[i][E][_](this,e),delete t[l],delete t[f],t},d[e]._toFullJSON=function(e){var n;return _t[St](n=_t[xt](this[c]),function(t,r){return n[key]=Mt[P](t,e)}),_t[St](this.__op,function(e,t){return n[e]=t}),_t.has(this,"id")&&(n[r]=this.id),_t.has(this,l)&&(n[l]=_t.isDate(this[l])?this[l][E]():this[l]),_t.has(this,f)&&(n[f]=_t.isDate(this[f])?this[f][E]():this[f]),n[S]=o,n[t]=this[t],n},d[e].__op={},d[e]._serverData={},d[e]._opSetQueue=[{}],d[e][Q]=O,d[e][yt]=function(){return this[Q]||this.hasChanged()},d[e][h]=function(){if(this[B]())throw new Error("Can't serialize an unsaved sparse.Object");return{__type:Y,className:this[t],objectId:this.id}},d[e][N]=function(e,t){var n=this;return this._opSetQueue=[{}],this[ft](e),_t[St](e,function(e,t){return n._serverData[key]=Mt[Z](t,e)}),this._hasData=t,this[Q]=O},d[e][ft]=function(e){var t=this;return _t[St](["id",r,l,f],function(n){if(e[n]){switch(e[n]){case r:t.id=e[n];break;case l:case f:t[n]=_t.isDate(e[n])?e[n]:Mt[ut](e[n])}return delete e[n]}})},d[e].add=function(e,t){var r;return _t[nt](r=this.get(wt))&&this.set({}[e]=r.concat(t),n),this[m]()},d[e].addUnique=function(e,t){var r;return _t[nt](r=this.get(wt))&&this.set({}[e]=_t.union(r,t),n),this[m]()},d[e].increment=function(e,t){var r;return _t.isNumber(r=this.get(wt))&&this.set({}[e]=r+(t!=n?t:t=1),n),this[m]()},d}(At.Model),Mt[o][pt]={},Mt[o][G]=function(e){var t,r,i;if(!_t.isString(e))throw"sparse.Object._getSubclass requires a string argument.";return(i=(r=Mt[o][pt])[e])!=n?i:r[e]=(t=Mt[o][pt][e])?t:Mt[o][g](e)},Mt[o]._create=function(e,t,n){var r;if(typeof (r=Mt[o][G](e))===V)return new r(t,n);throw"unable to create "+e},Mt[o].saveAll=function(e,t){var n=this;return(new Mt.Batch(e)).exec(t({complete:function(e,n,r){if(t[s])return t[s](e,n,r)},error:function(e,n,r){if(t[F])return t[F](e,n,r)}}))},Mt[o].destroyAll=function(e,t){var n=this;return(new Mt.Batch)[d](e,t({complete:function(e,n,r){if(t[s])return t[s](e,n,r)},error:function(e,n,r){if(t[F])return t[F](e,n,r)}}))},Mt[o][e].nestCollection=function(e,t){var n,r,i,s,o=this;for(n=i=0,s=t[$];i<s;n=++i)r=t[n],this[c][e][n]=t.at(n)[c];return t.bind("add",function(t){return o.get(e)||(o[c][e]=[]),o.get(e).push(t[c])}),t.bind("remove",function(t){var n;return n={},n[e]=_t.without(o.get(e),t[c]),o.set(n)}),t},Mt.Model=Mt[o],Mt[U]=function(r){function o(e,r){var s;o[i][u][_](this,e,r),((s=this[t])!=n?s:this[t]=Mt[p](this))===Mt[x]?console.warn("sparse.Collection requires className to be defined"):this[t]=Mt[at].pluralize(this[t]),this}return Bt(o,r),o[e].__count=void 0,o[e][ht]=function(){return this.__count||this[K][$]},o[e][W]={limit:Mt[D],count:1},o[e][vt]=function(){var e=this;return _t.map(_t.pairs(this[W]||n),function(e,t){return e.join("=")}).join("&")},o[e].url=function(){var e;return encodeURI(""+Mt[y]+z+this[t]+(this[st]==="read"&&(e=this[vt]())[$]?"?"+e:""))},o[e].parse=function(e){var t;return(t=o[i].parse[_](this,e)).results||t},o[e].sync=function(e,t,r){var u,a=this;return this[st]=e,r==n&&(r={}),u=Mt[dt](),this[st]===Mt[J].read&&_t[St]([Ct,ht,Tt,"where"],function(e,t){if(r[e])return a[W][e]=JSON[k](r[e])[et](/\\{2}/g,"\\"),delete r[e]}),console.log(this[W]),u[s]=function(e,t,i){a[W]={limit:Mt[D],count:1};if(r[s]!=n)return r[s](e,t,i)},u[F]=function(e,t,n){if(r[F])return r[F](e,t,n)},o[i].sync[_](this,this[st],this,_t[g](_t[xt](r),u))},o[e].query=function(e,t){return t==n&&(t={}),this.fetch(_t[g](t,{where:e}))},o[e].save=function(e){var t=this;return(new Mt.Batch(_t.compact(_t.map(this[K],function(e,t){if(e[B]()||e[yt]())return e})))).exec(e({complete:function(t,n,r){if(e[s])return e[s](t,n,r)},error:function(t,n,r){if(e[F])return e[F](t,n,r)}}))},o}(At[U]),Mt.Batch=function(o){function f(e,t){f[i][u][_](this,e,t)}return Bt(f,o),f[e].url=function(){return""+Mt[y]+"/batch"},f[e][b]=[],f[e].processed=function(e){return e==n&&(e=H),e?_t.flatten(this[b]):this[b]},f[e][E]=function(e){return JSON[k]({requests:f[i][E][_](this,e)})},f[e][C]=function(e){return e[a](B)&&e[B]()||typeof e.get(r)===T||e.get(r===n||e.get(r===""))},f[e][Lt]=function(e,s){var o;return s==n&&(s={}),s[a](d)||(s=_t[g](s,{destroy:O})),s[d]&&this[C](e)?o=n:(o={method:Mt[J][s[d]?d:this[C](e)?ot:"update"],path:"/"+Mt.API_VERSION+z+e[t]+(this[C](e)?"":"/"+e.get(r))},s[d]||(o.body=e)),f[i][Lt][_](this,o,s)},f[e].sync=function(e,t,n){var r,i=this;if(!t[K]||t[K][$]===0)return;return r=Mt[dt](),r.data=JSON[k]({requests:this[tt]=t.slice(0,Mt[R]>=0&&Mt[R]<t[K][$]?Mt[R]:t[K][$])}),r[s]=function(r,o,u){i[b].push(_t.map(r,function(e,t,n){return _t.chain(i[tt][t].get("body")).tap(function(t){return typeof t!==T?t.set(e[s]):t=e[s]}).value()})),i.remove(i[tt],{index:0,silent:H}),setTimeout(function(){if(t[K][$]>0)return i.sync(e,i,n);if(n[kt])return n[kt](i[b],o,u)},200);if(n[s])return n[s](r,o,u)},r[F]=function(e,t,r){if(n[F])return n[F](e,t,r)},r[kt]=function(e,t,r){if(n.completed)return n.completed(e,t,r)},At.sync(e,t,_t[g](_t[xt](n),r))},f[e].fetch=function(e){return console.warn('Method: "fetch" is not supported by sparse.Batch. Use sparse.Collection instead')},f[e].exec=function(e){return this.sync(ot,this,e)},f[e][d]=function(e,t){return this.add(e,_t[g](_t[xt](t||{}),{destroy:H}))},f[e].save=function(e,t){return this.add(e,t)},f}(Mt[U]),Mt.User=function(t){function o(){return Dt=o[i][u].apply(this,arguments),Dt}return Bt(o,t),o[e].defaults={username:n,password:n,email:n},o[e][w]=M,o[e][rt]={create:""+Mt[y]+it,login:""+Mt[y]+"/login",passwordReset:""+Mt[y]+"/requestPasswordReset",operate:""+Mt[y]+it},o[e].url=function(){return this[rt][this[w]]+(this[w]===M&&!this[B]()?"/"+this.get(r):"")},o[e].signUp=function(e,t){return this.save(e||n,t)},o[e].logIn=function(e,t,n){var r,i=this;return this[w]=q,this[rt][q]=encodeURI(this[rt][q][et](/\/login+.*/,"/login?username="+e+"&password="+t)),(r={})[s]=function(e,t,r){Mt[I]=i.get(mt),delete i[c][mt];if(n[s])return n[s](e,t,r)},this.fetch(_t[g](_t[xt](n),r))},o[e].logOut=function(){return Mt[I]=void 0,this[rt][q]=this[rt][q][et](/\/login+.*/,"/login"),this.id=n,this.set(this.defaults)},o[e].resetPassword=function(e){var t;return(t=this.get("email"))===n?O:(this[w]="passwordReset",o[i].save[_](this,{email:t},e))},o[e].save=function(e,t){return this[w]=this[B]()?ot:M,o[i].save[_](this,e,t)},o[e][d]=function(e){var t,n=this;return this[w]=M,(t={})[s]=function(t,r,i){n.logOut();if(e[s])return e[s](t,r,i)},o[i][d][_](this,_t[g](_t[xt](e),t))},o}(Mt[o]),Mt.Users=function(t){function n(){return Pt=n[i][u].apply(this,arguments),Pt}return Bt(n,t),n[e].url=function(){return""+Mt[y]+it},n}(Mt[U]),Mt.Query=function(i){function s(e){e!=n&&(this[v]=_t.isString(e)?Mt[o][G](e):e,this[t]=this[v][t]||Mt[p](this[v])),this.or=this._or,this["in"]=this._in}return Bt(s,i),s[e].__q={},s[e].__include=[],s[e].__limit=-1,s[e].__skip=0,s[e].__extraOpts={},s[e].find=function(e){var r=this;e==n&&(e={});if(typeof this[v]!==V)throw"no valid Class required";return(new this[v]).sync(Mt[J].read,[],_t[g](e,{where:this.__q})).then(function(e,n,i){return _t[St](n.results,function(e,n){var i;return(i=e[t]?new Mt[o](e[t]):new r[v])[N](e,H),i})})},s[e].first=function(e){return e==n&&(e={}),this.find(_t[g](e,{skip:0,limit:1}))},s[e].set=function(e,t,r){var i,s;return e!=n&&(s=(i=this.__q)[e])==n&&(i[e]={}),(this.__q[e]||this.__q)[t]=""+r,this},s[e][vt]=function(){var e=this;return _t.map(_t.pairs(this.__q,function(e,t){return e.join("=")})).join("&")},s[e][E]=function(){return JSON[k](this.__q)},s[e].equalTo=function(e,t){return this.set(n,e,t)},s[e].notEqualTo=function(e,t){return this.set(e,"$ne",t)},s[e].dontSelect=function(e){return this.set(n,"$dontSelect",{query:e})},s[e].exists=function(e){return this.set(e,Nt,H)},s[e].doesNotExist=function(e){return this.set(e,Nt,O)},s[e].greaterThan=function(e,t){return this.set(e,"$gt",t)},s[e].greaterThanOrEqualTo=function(e,t){return this.set(e,"$gte",t)},s[e].lessThan=function(e,t){return this.set(e,"$lt",t)},s[e].lessThanOrEqualTo=function(e,t){return this.set(e,"$lte",t)},s[e].contains=function(e,t){return this.set(e,"$regex",""+Mt.Query._quote(t))},s[e].containsAll=function(e,t){return this.set(n,"$all")},s[e].containedIn=function(e,t){return this.set(e,"$in",array)},s[e].notContainedIn=function(e,t){return this.set(e,"$nin",t)},s[e].select=function(e,t){return this.set(e,"$select",{query:t})},s[e].inQuery=function(e,t){return this.set(e,"$inQuery",{where:t})},s[e].notInQuery=function(e,t){return this.set(e,"$notInQuery",{where:t})},s[e]._or=function(e){return(this.__q.$or||(this.__q.$or={})).push(e.__q)},s[e].relatedTo=function(e){return(!e.get||e.get(r===n||typeof e[lt]===T))&&console[F]("Parsely.Statement.$relatedTo required object be of Type Parsely.Model"),this.set(n,"$relatedTo",{__type:Y,objectId:e.get(r),className:e[lt]})},s[e].include=function(e){return this.set(n,"include",""+e)},s[e].keys=function(e){return this.set(n,"keys",""+value)},s[e][ht]=function(e){return this.set(n,ht,""+e)},s[e][Ct]=function(e){return this.set(n,Ct,""+e)},s[e][Tt]=function(e){return this.set(n,Tt,""+e)},s[e].skip=function(e){return this.set(n,"skip",""+e)},s[e].arrayKey=function(e,t){return this.set(n,e,""+t)},s}(Object),Mt.Query.or=function(){var e,r,i,s=this;return r=n,_t[St](e=_t.toArray(arguments),function(e){if((r!=n?r:r=e[t])!==e[t])throw"All queries must be for the same class"}),(i=new Mt.Query(r))._orQuery(e),i},Mt.Query._quote=function(e){return"\\Q"+e+"\\E"}}).call(this);