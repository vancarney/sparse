// Generated by CoffeeScript 1.6.2
(function(){var e="prototype",t="className",n=null,r="__super__",i="objectId",s="Object",o="success",u="constructor",a="updatedAt",f="createdAt",l="getConstructorName",c="API_URI",h="changedAttributes",p="objectClass",d="__type",v="toJSON",m="destroy",g="UNDEFINED_CLASSNAME",y="undefined",b="__processed",w="_finishFetch",E="__action",S="extend",x="GeoPoint",T=!1,N="Relation",C="call",k="_memberIsNew",L=!0,A="hasOwnProperty",O="DEFAULT_FETCH_LIMIT_OVERRIDE",M="SESSION_TOKEN",_="stringify",D="error",P="operate",H="login",B="replace",j="_encode",F="_decode",I="application/json",q="File",R="MAX_BATCH_SIZE",U="Collection",z="/classes/",W="Pointer",X="__params",V="attributes",$="CRUD_METHODS",J="_parseDate",K="_getSubclass",Q="__isDirty",G="models",Y="apiOPTS",Z="isArray",et="__to_remove",tt="urlMap",nt="length",rt="__method",it="/users",st="include",ot="isNew",ut="create",at="defaults",ft="__parse_classname",lt="Inflection",ct="_mergeMagicFields",ht="validateRoute",pt="getParams",dt="count",vt="sessionToken",mt="_classMap",gt="attr",yt="function",bt="$1es",wt="$exists",Et="complete",St="_prepareModel",xt="limit",Tt="order",Nt="clone",Ct,kt,Lt,At,Ot,Mt,_t={}[A],Dt=function(t,n){function s(){this[u]=t}for(var i in n)_t[C](n,i)&&(t[i]=n[i]);return s[e]=n[e],t[e]=new s,t[r]=n[e],t};kt=exports||window,typeof exports!==y&&(At=require("underscore")._,Ct=require("backbone")),kt.sparse||(Lt=kt.sparse={VERSION:"0.3.1-alpha",APP_ID:void 0,REST_KEY:void 0,SESSION_TOKEN:void 0,API_VERSION:"1",MAX_BATCH_SIZE:50,DEFAULT_FETCH_LIMIT_OVERRIDE:2e5,UNDEFINED_CLASSNAME:"__UNDEFINED_CLASSNAME__",API_URI:"https://api.parse.com/1",CRUD_METHODS:{create:"POST",read:"GET",update:"PUT",destroy:"DELETE"}}),Lt[Y]=function(){return{contentType:I,processData:T,dataType:"json",data:n,headers:{"Content-Type":I,"X-Parse-Application-Id":Lt.APP_ID,"X-Parse-REST-API-Key":Lt.REST_KEY,"X-Parse-Session-Token":Lt[M]}}},Lt.regEscape=function(e){return e[B](/([\^\/\.\-\+\*\[\]\{\}\|\(\)\?\$]+)/g,"\\$1")},Lt[ht]=function(e){if(!e.match(new RegExp("^("+Lt.regEscape(Lt[c])+"/)?(batch|classes|events|files|functions|login|push|requestPasswordReset|users|jobs)+")))throw"Bad route: "+e;return L},Lt[J]=function(e){var t;return(t=e.match(/^([0-9]{1,4})\-([0-9]{1,2})\-([0-9]{1,2})T+([0-9]{1,2}):+([0-9]{1,2}):?([0-9]{1,2})?(.([0-9]+))?Z+$/))===n?n:new Date(Date.UTC(t[1]||0,(t[2]||1)-1,t[3]||0,t[4]||0,t[5]||0,t[6]||0,t[8]||0))},Lt[l]=function(e){var t;return e[u].name||((t=e[u].toString().match(/function+\s{1,}([A-Z]{1}[a-zA-Z]*)/))!=n?t[1]:Lt[g])},Lt[j]=function(e,t,n){var r;if(e instanceof Lt.Model&&n)throw"sparse.Models not allowed here";if(!t||At[st](t,e)||e[V]!==e[at])return e._toPointer();if(!e.dirty())return Lt[j](e._toFullJSON(t=t.concat(e)),t,n);throw"Tried to save Model with a Pointer to an new or unsaved Object."},Lt[F]=function(e,r){var o,u,a,f,l;return At.isObject(r)?At[Z](r)?(At.each(r,function(e,t){return r[t]=Lt[F](t,e)}),r):r instanceof Lt[s]||Lt[q]&&r instanceof Lt[q]||Lt.OP&&r instanceof Lt.Op?r:r.__op?Lt.OP[F](r):r[d]&&r[d]===W?(f=Lt[s]._create(r[t]),f[w]({objectId:r[i]},T),f):r[d]&&r[d]===s?(o=r[t],delete r[d],delete r[t],a=Lt[s]._create(o),a[w](r,L),a):r[d]==="Date"?Lt[J](r.iso):Lt[x]&&r[d]===x?new Lt[x]({latitude:r.latitude,longitude:r.longitude}):Lt[N]&&r[d]===N?((l=new Lt[N](n,e)).targetClassName=r[t],l):Lt[q]&&r[d]===q?((u=new sarse[q](r.name)).url=r.url,u):(At.each(r,function(e,t){return r[t]=Lt[F](t,e)}),r):r},Lt[lt]=new function(){return{__uncountable_words:["equipment","information","rice","money","species","series","fish","sheep","moose","deer","news"],__plural_rules:[[/(m)an$/gi,"$1en"],[/(pe)rson$/gi,"$1ople"],[/(child)$/gi,"$1ren"],[/^(ox)$/gi,"$1en"],[/(ax|test)is$/gi,bt],[/(octop|vir)us$/gi,"$1i"],[/(alias|status)$/gi,bt],[/(bu)s$/gi,"$1ses"],[/(buffal|tomat|potat)o$/gi,"$1oes"],[/([ti])um$/gi,"$1a"],[/sis$/gi,"ses"],[/(?:([^f])fe|([lr])f)$/gi,"$1$2ves"],[/(hive)$/gi,"$1s"],[/([^aeiouy]|qu)y$/gi,"$1ies"],[/(x|ch|ss|sh|lens)$/gi,bt],[/(matr|vert|ind)ix|ex$/gi,"$1ices"],[/([m|l])ouse$/gi,"$1ice"],[/(quiz)$/gi,"$1zes"],[/s$/gi,"s"],[/$/gi,"s"]],apply_rules:function(e,t,r){var i,s=this;return r.indexOf(e.toLowerCase())===-1&&(i=At.find(t,function(t){return e.match(t[0])}))!=n?e[B](i[0],i[1]):e},pluralize:function(e){return this.apply_rules(e,this.__plural_rules,this.__uncountable_words)}}},Lt[s]=function(o){function p(e,i){var s;p[r][u][C](this,e,i),((s=this[t])!=n?s:this[t]=Lt[l](this))===Lt[g]?console.warn("sparse.Object requires className to be defined"):this[t]=Lt[lt].pluralize(this[t])}return Dt(p,o),p[e].idAttribute=i,p[e].url=function(){return""+Lt[c]+z+this[t]+(this[ot]()?"":"/"+this.get(i))},p[e].sync=function(e,t,i){var s,o;return i==n&&(i={}),s=Lt[Y](),s.data=JSON[_](this[v]()),Lt[ht]((o=i.url)!=n?o:i.url=At.result(this,"url")||"/"),p[r].sync[C](this,e,t,At[S](i,s))},p[e].set=function(e,t){var n;return n=p[r].set[C](this,e,t),this[h]()&&(this[Q]=L),n},p[e][v]=function(e){var t;return t=p[r][v][C](this,e),delete t[f],delete t[a],t},p[e]._toFullJSON=function(e){var n;return At.each(n=At[Nt](this[V]),function(t,r){return n[key]=Lt[j](t,e)}),At.each(this.__op,function(e,t){return n[e]=t}),At.has(this,"id")&&(n[i]=this.id),At.has(this,f)&&(n[f]=At.isDate(this[f])?this[f][v]():this[f]),At.has(this,a)&&(n[a]=At.isDate(this[a])?this[a][v]():this[a]),n[d]=s,n[t]=this[t],n},p[e].__op={},p[e]._serverData={},p[e]._opSetQueue=[{}],p[e][Q]=T,p[e].dirty=function(){return this[Q]||this.hasChanged()},p[e]._toPointer=function(){if(this[ot]())throw new Error("Can't serialize an unsaved sparse.Object");return{__type:W,className:this[t],objectId:this.id}},p[e][w]=function(e,t){var n=this;return this._opSetQueue=[{}],this[ct](e),At.each(e,function(e,t){return n._serverData[key]=Lt[F](t,e)}),this._hasData=t,this[Q]=T},p[e][ct]=function(e){var t=this;return At.each(["id",i,f,a],function(n){if(e[n]){switch(e[n]){case i:t.id=e[n];break;case f:case a:t[n]=At.isDate(e[n])?e[n]:Lt[J](e[n])}return delete e[n]}})},p[e].add=function(e,t){var r;return At[Z](r=this.get(gt))&&this.set({}[e]=r.concat(t),n),this[h]()},p[e].addUnique=function(e,t){var r;return At[Z](r=this.get(gt))&&this.set({}[e]=At.union(r,t),n),this[h]()},p[e].increment=function(e,t){var r;return At.isNumber(r=this.get(gt))&&this.set({}[e]=r+(t!=n?t:t=1),n),this[h]()},p}(Ct.Model),Lt[s][mt]={},Lt[s][K]=function(e){var t,r,i;if(!At.isString(e))throw"sparse.Object._getSubclass requires a string argument.";return(i=(r=Lt[s][mt])[e])!=n?i:r[e]=(t=Lt[s][mt][e])?t:Lt[s][S](e)},Lt[s]._create=function(e,t,n){var r;if(typeof (r=Lt[s][K](e))===yt)return new r(t,n);throw"unable to create "+e},Lt[s].saveAll=function(e,t){var n=this;return(new Lt.Batch(e)).exec(t({complete:function(e,n,r){if(t[o])return t[o](e,n,r)},error:function(e,n,r){if(t[D])return t[D](e,n,r)}}))},Lt[s].destroyAll=function(e,t){var n=this;return(new Lt.Batch)[m](e,t({complete:function(e,n,r){if(t[o])return t[o](e,n,r)},error:function(e,n,r){if(t[D])return t[D](e,n,r)}}))},Lt.Model=Lt[s],Lt[U]=function(i){function s(e,i){var o;s[r][u][C](this,e,i),((o=this[t])!=n?o:this[t]=Lt[l](this))===Lt[g]?console.warn("sparse.Collection requires className to be defined"):this[t]=Lt[lt].pluralize(this[t]),this}return Dt(s,i),s[e].__count=void 0,s[e][dt]=function(){return this.__count||this[G][nt]},s[e][X]={limit:Lt[O],count:1},s[e][pt]=function(){var e=this;return At.map(At.pairs(this[X]||n),function(e,t){return e.join("=")}).join("&")},s[e].url=function(){var e;return encodeURI(""+Lt[c]+z+this[t]+(this[rt]==="read"&&(e=this[pt]())[nt]?"?"+e:""))},s[e].parse=function(e){var t;return(t=s[r].parse[C](this,e)).results||t},s[e].sync=function(e,t,i){var u,a=this;return this[rt]=e,i==n&&(i={}),u=Lt[Y](),this[rt]===Lt[$].read&&At.each([Tt,dt,xt,"where"],function(e,t){if(i[e])return a[X][e]=JSON[_](i[e])[B](/\\{2}/g,"\\"),delete i[e]}),console.log(this[X]),u[o]=function(e,t,r){a[X]={limit:Lt[O],count:1};if(i[o]!=n)return i[o](e,t,r)},u[D]=function(e,t,n){if(i[D])return i[D](e,t,n)},s[r].sync[C](this,this[rt],this,At[S](At[Nt](i),u))},s[e].query=function(e,t){return t==n&&(t={}),this.fetch(At[S](t,{where:e}))},s[e].save=function(e){var t=this;return(new Lt.Batch(At.compact(At.map(this[G],function(e,t){if(e[ot]()||e.dirty())return e})))).exec(e({complete:function(t,n,r){if(e[o])return e[o](t,n,r)},error:function(t,n,r){if(e[D])return e[D](t,n,r)}}))},s}(Ct[U]),Lt.Batch=function(s){function a(e,t){a[r][u][C](this,e,t)}return Dt(a,s),a[e].url=function(){return""+Lt[c]+"/batch"},a[e][b]=[],a[e].processed=function(e){return e==n&&(e=L),e?At.flatten(this[b]):this[b]},a[e][v]=function(e){return JSON[_]({requests:a[r][v][C](this,e)})},a[e][k]=function(e){return e[A](ot)&&e[ot]()||typeof e.get(i)===y||e.get(i===n||e.get(i===""))},a[e][St]=function(e,s){var o;return s==n&&(s={}),s[A](m)||(s=At[S](s,{destroy:T})),s[m]&&this[k](e)?o=n:(o={method:Lt[$][s[m]?m:this[k](e)?ut:"update"],path:"/"+Lt.API_VERSION+z+e[t]+(this[k](e)?"":"/"+e.get(i))},s[m]||(o.body=e)),a[r][St][C](this,o,s)},a[e].sync=function(e,t,n){var r,i=this;if(!t[G]||t[G][nt]===0)return;return r=Lt[Y](),r.data=JSON[_]({requests:this[et]=t.slice(0,Lt[R]>=0&&Lt[R]<t[G][nt]?Lt[R]:t[G][nt])}),r[o]=function(r,s,u){i[b].push(At.map(r,function(e,t,n){return At.chain(i[et][t].get("body")).tap(function(t){return typeof t!==y?t.set(e[o]):t=e[o]}).value()})),i.remove(i[et],{index:0,silent:L}),setTimeout(function(){if(t[G][nt]>0)return i.sync(e,i,n);if(n[Et])return n[Et](i[b],s,u)},200);if(n[o])return n[o](r,s,u)},r[D]=function(e,t,r){if(n[D])return n[D](e,t,r)},r[Et]=function(e,t,r){if(n.completed)return n.completed(e,t,r)},Ct.sync(e,t,At[S](At[Nt](n),r))},a[e].fetch=function(e){return console.warn('Method: "fetch" is not supported by sparse.Batch. Use sparse.Collection instead')},a[e].exec=function(e){return this.sync(ut,this,e)},a[e][m]=function(e,t){return this.add(e,At[S](At[Nt](t||{}),{destroy:L}))},a[e].save=function(e,t){return this.add(e,t)},a}(Lt[U]),Lt.User=function(t){function s(){return Ot=s[r][u].apply(this,arguments),Ot}return Dt(s,t),s[e][at]={username:n,password:n,email:n},s[e][E]=P,s[e][tt]={create:""+Lt[c]+it,login:""+Lt[c]+"/login",passwordReset:""+Lt[c]+"/requestPasswordReset",operate:""+Lt[c]+it},s[e].url=function(){return this[tt][this[E]]+(this[E]===P&&!this[ot]()?"/"+this.get(i):"")},s[e].signUp=function(e,t){return this.save(e||n,t)},s[e].logIn=function(e,t,n){var r,i=this;return this[E]=H,this[tt][H]=encodeURI(this[tt][H][B](/\/login+.*/,"/login?username="+e+"&password="+t)),(r={})[o]=function(e,t,r){Lt[M]=i.get(vt),delete i[V][vt];if(n[o])return n[o](e,t,r)},this.fetch(At[S](At[Nt](n),r))},s[e].logOut=function(){return Lt[M]=void 0,this[tt][H]=this[tt][H][B](/\/login+.*/,"/login"),this.id=n,this.set(this[at])},s[e].resetPassword=function(e){var t;return(t=this.get("email"))===n?T:(this[E]="passwordReset",s[r].save[C](this,{email:t},e))},s[e].save=function(e,t){return this[E]=this[ot]()?ut:P,s[r].save[C](this,e,t)},s[e][m]=function(e){var t,n=this;return this[E]=P,(t={})[o]=function(t,r,i){n.logOut();if(e[o])return e[o](t,r,i)},s[r][m][C](this,At[S](At[Nt](e),t))},s}(Lt[s]),Lt.Users=function(t){function n(){return Mt=n[r][u].apply(this,arguments),Mt}return Dt(n,t),n[e].url=function(){return""+Lt[c]+it},n}(Lt[U]),Lt.Query=function(r){function o(e){e!=n&&(this[p]=At.isString(e)?Lt[s][K](e):e,this[t]=this[p][t]||Lt[l](this[p])),this.or=this._or,this["in"]=this._in}return Dt(o,r),o[e].__q={},o[e].__include=[],o[e].__limit=-1,o[e].__skip=0,o[e].__extraOpts={},o[e].find=function(e){var r=this;e==n&&(e={});if(typeof this[p]!==yt)throw"no valid Class required";return(new this[p]).sync(Lt[$].read,[],At[S](e,{where:this.__q})).then(function(e,n,i){return At.each(n.results,function(e,n){var i;return(i=e[t]?new Lt[s](e[t]):new r[p])[w](e,L),i})})},o[e].first=function(e){return e==n&&(e={}),this.find(At[S](e,{skip:0,limit:1}))},o[e].set=function(e,t,r){var i,s;return e!=n&&(s=(i=this.__q)[e])==n&&(i[e]={}),(this.__q[e]||this.__q)[t]=""+r,this},o[e][pt]=function(){var e=this;return At.map(At.pairs(this.__q,function(e,t){return e.join("=")})).join("&")},o[e][v]=function(){return JSON[_](this.__q)},o[e].equalTo=function(e,t){return this.set(n,e,t)},o[e].notEqualTo=function(e,t){return this.set(e,"$ne",t)},o[e].dontSelect=function(e){return this.set(n,"$dontSelect",{query:e})},o[e].exists=function(e){return this.set(e,wt,L)},o[e].doesNotExist=function(e){return this.set(e,wt,T)},o[e].greaterThan=function(e,t){return this.set(e,"$gt",t)},o[e].greaterThanOrEqualTo=function(e,t){return this.set(e,"$gte",t)},o[e].lessThan=function(e,t){return this.set(e,"$lt",t)},o[e].lessThanOrEqualTo=function(e,t){return this.set(e,"$lte",t)},o[e].contains=function(e,t){return this.set(e,"$regex",""+Lt.Query._quote(t))},o[e].containsAll=function(e,t){return this.set(n,"$all")},o[e].containedIn=function(e,t){return this.set(e,"$in",array)},o[e].notContainedIn=function(e,t){return this.set(e,"$nin",t)},o[e].select=function(e,t){return this.set(e,"$select",{query:t})},o[e].inQuery=function(e,t){return this.set(e,"$inQuery",{where:t})},o[e].notInQuery=function(e,t){return this.set(e,"$notInQuery",{where:t})},o[e]._or=function(e){return(this.__q.$or||(this.__q.$or={})).push(e.__q)},o[e].relatedTo=function(e){return(!e.get||e.get(i===n||typeof e[ft]===y))&&console[D]("Parsely.Statement.$relatedTo required object be of Type Parsely.Model"),this.set(n,"$relatedTo",{__type:W,objectId:e.get(i),className:e[ft]})},o[e][st]=function(e){return this.set(n,st,""+e)},o[e].keys=function(e){return this.set(n,"keys",""+value)},o[e][dt]=function(e){return this.set(n,dt,""+e)},o[e][Tt]=function(e){return this.set(n,Tt,""+e)},o[e][xt]=function(e){return this.set(n,xt,""+e)},o[e].skip=function(e){return this.set(n,"skip",""+e)},o[e].arrayKey=function(e,t){return this.set(n,e,""+t)},o}(Object),Lt.Query.or=function(){var e,r,i,s=this;return r=n,At.each(e=At.toArray(arguments),function(e){if((r!=n?r:r=e[t])!==e[t])throw"All queries must be for the same class"}),(i=new Lt.Query(r))._orQuery(e),i},Lt.Query._quote=function(e){return"\\Q"+e+"\\E"}}).call(this);